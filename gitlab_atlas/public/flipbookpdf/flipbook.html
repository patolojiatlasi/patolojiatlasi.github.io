<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patoloji Atlasi Flipbook</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="turn.min.js"></script>
  <script src="pdfjs/build/pdf.js"></script>
  <style>
    body, html { 
      margin: 0; 
      padding: 0; 
      overflow: hidden; 
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #flipbook { 
      width: 90vw; 
      height: 90vh; 
    }
    #flipbook .page { 
      background-color: white;
    }
    .page canvas { 
      width: 100%; 
      height: 100%; 
    }
  </style>
</head>
<body>
  <div id="flipbook"></div>
  <script>
    // Ensure PDF.js worker is available
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'pdfjs/build/pdf.worker.js';

    // Load the PDF document
    pdfjsLib.getDocument('Patoloji-Atlasi.pdf').promise.then(function(pdf) {
      var numPages = pdf.numPages;
      var flipbook = document.getElementById('flipbook');

      // Create promises for each page
      var pagePromises = [];
      for (var i = 1; i <= numPages; i++) {
        pagePromises.push(pdf.getPage(i));
      }

      // Render all pages
      Promise.all(pagePromises).then(function(pages) {
        pages.forEach(function(page) {
          var scale = 1.5;
          var viewport = page.getViewport({scale: scale});

          var pageDiv = document.createElement('div');
          pageDiv.className = 'page';
          flipbook.appendChild(pageDiv);

          var canvas = document.createElement('canvas');
          var context = canvas.getContext('2d');
          canvas.height = viewport.height;
          canvas.width = viewport.width;

          var renderContext = {
            canvasContext: context,
            viewport: viewport
          };

          page.render(renderContext);
          pageDiv.appendChild(canvas);
        });

        // Initialize turn.js after all pages are rendered
        .ready(function() {
          .turn({
            width: .width(),
            height: .height(),
            autoCenter: true,
            when: {
              turning: function(event, page, view) {
                if (page == 1) {
                  event.preventDefault();
                }
              }
            }
          });
        });
      });
    }).catch(function(error) {
      console.error('Error loading PDF:', error);
    });

    // Resize handler
    .resize(function() {
      .turn("size", .width(), .height());
    });
  </script>
</body>
</html>
